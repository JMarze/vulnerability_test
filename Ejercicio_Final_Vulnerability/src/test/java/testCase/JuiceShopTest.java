package testCase;

import juiceShop.*;
import org.junit.jupiter.api.*;
import session.Session;

import static util.EnvConfig.*;

public class JuiceShopTest {
    // Pages
    WelcomeModal welcomeModal = new WelcomeModal();
    MenuBar menuBar = new MenuBar();
    Login login = new Login();
    CookiesModal cookiesModal = new CookiesModal();
    ProductList productList = new ProductList();
    Basket basket = new Basket();
    AddressSelect addressSelect = new AddressSelect();
    AddressCreate addressCreate = new AddressCreate();

    @BeforeAll
    public static void openBrowser () {
        Session.getInstance().getBrowser().get(HOST);
    }

    @Test
    public void loginTest() {
        welcomeModal.dismissButton.click();

        menuBar.accountButton.click();
        menuBar.loginButton.click();

        login.emailTextBox.setText(USER);
        login.passwordTextBox.setText(PWD);
        login.loginButton.click();

        Assertions.assertTrue(productList.addToBasketProduct1.isControlDisplayed(),
                "ERROR: No se inició la sesión...");
    }

    @Test
    public void addToBasketTest() throws InterruptedException {
        // Accept Cookies
        if (cookiesModal.meWantItButton.isControlDisplayed())
            cookiesModal.meWantItButton.click();

        // Select products
        productList.addToBasketProduct1.click();
        productList.addToBasketProduct2.click();
        productList.addToBasketProduct3.click();

        menuBar.yourBasketButton.click();

        // Add quantities
        basket.plusProduct1.click();
        basket.plusProduct2.click();
        basket.plusProduct3.click();
        basket.deleteProduct1.click();
        Thread.sleep(5000);

        // Checkout
        basket.checkoutButton.click();
    }

    @Test
    public void addAddress () throws InterruptedException {
        addressSelect.addNewAddressButton.click();

        // New Address
        addressCreate.countryTextBox.setText("La Paz");
        addressCreate.nameTextBox.setText("Sucursal Central");
        addressCreate.mobileNumberTextBox.setText("70512547");
        addressCreate.zipCodeTextBox.setText("591");
        addressCreate.addressTextBox.setText("Achumani, Calle 45 #124");
        addressCreate.cityTextBox.setText("La Paz");
        addressCreate.stateTextBox.setText("La Paz");
        addressCreate.submitButton.click();
    }

    @AfterAll
    public static void closeBrowser () {
        Session.getInstance().closeBrowser();
    }
}
